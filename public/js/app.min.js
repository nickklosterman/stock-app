(function(){var t=this,e=t._,i={},n=Array.prototype,r=Object.prototype,s=Function.prototype,a=n.push,o=n.slice,h=n.concat,l=r.toString,u=r.hasOwnProperty,c=n.forEach,p=n.map,g=n.reduce,f=n.reduceRight,d=n.filter,v=n.every,m=n.some,y=n.indexOf,x=n.lastIndexOf,w=Array.isArray,b=Object.keys,_=s.bind,C=function(t){return t instanceof C?t:this instanceof C?void(this._wrapped=t):new C(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=C),exports._=C):t._=C,C.VERSION="1.5.2";var S=C.each=C.forEach=function(t,e,n){if(null!=t)if(c&&t.forEach===c)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,s=t.length;s>r;r++)if(e.call(n,t[r],r,t)===i)return}else for(var a=C.keys(t),r=0,s=a.length;s>r;r++)if(e.call(n,t[a[r]],a[r],t)===i)return};C.map=C.collect=function(t,e,i){var n=[];return null==t?n:p&&t.map===p?t.map(e,i):(S(t,function(t,r,s){n.push(e.call(i,t,r,s))}),n)};var k="Reduce of empty array with no initial value";C.reduce=C.foldl=C.inject=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),g&&t.reduce===g)return n&&(e=C.bind(e,n)),r?t.reduce(e,i):t.reduce(e);if(S(t,function(t,s,a){r?i=e.call(n,i,t,s,a):(i=t,r=!0)}),!r)throw new TypeError(k);return i},C.reduceRight=C.foldr=function(t,e,i,n){var r=arguments.length>2;if(null==t&&(t=[]),f&&t.reduceRight===f)return n&&(e=C.bind(e,n)),r?t.reduceRight(e,i):t.reduceRight(e);var s=t.length;if(s!==+s){var a=C.keys(t);s=a.length}if(S(t,function(o,h,l){h=a?a[--s]:--s,r?i=e.call(n,i,t[h],h,l):(i=t[h],r=!0)}),!r)throw new TypeError(k);return i},C.find=C.detect=function(t,e,i){var n;return R(t,function(t,r,s){return e.call(i,t,r,s)?(n=t,!0):void 0}),n},C.filter=C.select=function(t,e,i){var n=[];return null==t?n:d&&t.filter===d?t.filter(e,i):(S(t,function(t,r,s){e.call(i,t,r,s)&&n.push(t)}),n)},C.reject=function(t,e,i){return C.filter(t,function(t,n,r){return!e.call(i,t,n,r)},i)},C.every=C.all=function(t,e,n){e||(e=C.identity);var r=!0;return null==t?r:v&&t.every===v?t.every(e,n):(S(t,function(t,s,a){return(r=r&&e.call(n,t,s,a))?void 0:i}),!!r)};var R=C.some=C.any=function(t,e,n){e||(e=C.identity);var r=!1;return null==t?r:m&&t.some===m?t.some(e,n):(S(t,function(t,s,a){return r||(r=e.call(n,t,s,a))?i:void 0}),!!r)};C.contains=C.include=function(t,e){return null==t?!1:y&&t.indexOf===y?-1!=t.indexOf(e):R(t,function(t){return t===e})},C.invoke=function(t,e){var i=o.call(arguments,2),n=C.isFunction(e);return C.map(t,function(t){return(n?e:t[e]).apply(t,i)})},C.pluck=function(t,e){return C.map(t,function(t){return t[e]})},C.where=function(t,e,i){return C.isEmpty(e)?i?void 0:[]:C[i?"find":"filter"](t,function(t){for(var i in e)if(e[i]!==t[i])return!1;return!0})},C.findWhere=function(t,e){return C.where(t,e,!0)},C.max=function(t,e,i){if(!e&&C.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&C.isEmpty(t))return-1/0;var n={computed:-1/0,value:-1/0};return S(t,function(t,r,s){var a=e?e.call(i,t,r,s):t;a>n.computed&&(n={value:t,computed:a})}),n.value},C.min=function(t,e,i){if(!e&&C.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&C.isEmpty(t))return 1/0;var n={computed:1/0,value:1/0};return S(t,function(t,r,s){var a=e?e.call(i,t,r,s):t;a<n.computed&&(n={value:t,computed:a})}),n.value},C.shuffle=function(t){var e,i=0,n=[];return S(t,function(t){e=C.random(i++),n[i-1]=n[e],n[e]=t}),n},C.sample=function(t,e,i){return arguments.length<2||i?t[C.random(t.length-1)]:C.shuffle(t).slice(0,Math.max(0,e))};var M=function(t){return C.isFunction(t)?t:function(e){return e[t]}};C.sortBy=function(t,e,i){var n=M(e);return C.pluck(C.map(t,function(t,e,r){return{value:t,index:e,criteria:n.call(i,t,e,r)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index-e.index}),"value")};var H=function(t){return function(e,i,n){var r={},s=null==i?C.identity:M(i);return S(e,function(i,a){var o=s.call(n,i,a,e);t(r,o,i)}),r}};C.groupBy=H(function(t,e,i){(C.has(t,e)?t[e]:t[e]=[]).push(i)}),C.indexBy=H(function(t,e,i){t[e]=i}),C.countBy=H(function(t,e){C.has(t,e)?t[e]++:t[e]=1}),C.sortedIndex=function(t,e,i,n){i=null==i?C.identity:M(i);for(var r=i.call(n,e),s=0,a=t.length;a>s;){var o=s+a>>>1;i.call(n,t[o])<r?s=o+1:a=o}return s},C.toArray=function(t){return t?C.isArray(t)?o.call(t):t.length===+t.length?C.map(t,C.identity):C.values(t):[]},C.size=function(t){return null==t?0:t.length===+t.length?t.length:C.keys(t).length},C.first=C.head=C.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:o.call(t,0,e)},C.initial=function(t,e,i){return o.call(t,0,t.length-(null==e||i?1:e))},C.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:o.call(t,Math.max(t.length-e,0))},C.rest=C.tail=C.drop=function(t,e,i){return o.call(t,null==e||i?1:e)},C.compact=function(t){return C.filter(t,C.identity)};var T=function(t,e,i){return e&&C.every(t,C.isArray)?h.apply(i,t):(S(t,function(t){C.isArray(t)||C.isArguments(t)?e?a.apply(i,t):T(t,e,i):i.push(t)}),i)};C.flatten=function(t,e){return T(t,e,[])},C.without=function(t){return C.difference(t,o.call(arguments,1))},C.uniq=C.unique=function(t,e,i,n){C.isFunction(e)&&(n=i,i=e,e=!1);var r=i?C.map(t,i,n):t,s=[],a=[];return S(r,function(i,n){(e?n&&a[a.length-1]===i:C.contains(a,i))||(a.push(i),s.push(t[n]))}),s},C.union=function(){return C.uniq(C.flatten(arguments,!0))},C.intersection=function(t){var e=o.call(arguments,1);return C.filter(C.uniq(t),function(t){return C.every(e,function(e){return C.indexOf(e,t)>=0})})},C.difference=function(t){var e=h.apply(n,o.call(arguments,1));return C.filter(t,function(t){return!C.contains(e,t)})},C.zip=function(){for(var t=C.max(C.pluck(arguments,"length").concat(0)),e=new Array(t),i=0;t>i;i++)e[i]=C.pluck(arguments,""+i);return e},C.object=function(t,e){if(null==t)return{};for(var i={},n=0,r=t.length;r>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},C.indexOf=function(t,e,i){if(null==t)return-1;var n=0,r=t.length;if(i){if("number"!=typeof i)return n=C.sortedIndex(t,e),t[n]===e?n:-1;n=0>i?Math.max(0,r+i):i}if(y&&t.indexOf===y)return t.indexOf(e,i);for(;r>n;n++)if(t[n]===e)return n;return-1},C.lastIndexOf=function(t,e,i){if(null==t)return-1;var n=null!=i;if(x&&t.lastIndexOf===x)return n?t.lastIndexOf(e,i):t.lastIndexOf(e);for(var r=n?i:t.length;r--;)if(t[r]===e)return r;return-1},C.range=function(t,e,i){arguments.length<=1&&(e=t||0,t=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/i),0),r=0,s=new Array(n);n>r;)s[r++]=t,t+=i;return s};var j=function(){};C.bind=function(t,e){var i,n;if(_&&t.bind===_)return _.apply(t,o.call(arguments,1));if(!C.isFunction(t))throw new TypeError;return i=o.call(arguments,2),n=function(){if(!(this instanceof n))return t.apply(e,i.concat(o.call(arguments)));j.prototype=t.prototype;var r=new j;j.prototype=null;var s=t.apply(r,i.concat(o.call(arguments)));return Object(s)===s?s:r}},C.partial=function(t){var e=o.call(arguments,1);return function(){return t.apply(this,e.concat(o.call(arguments)))}},C.bindAll=function(t){var e=o.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return S(e,function(e){t[e]=C.bind(t[e],t)}),t},C.memoize=function(t,e){var i={};return e||(e=C.identity),function(){var n=e.apply(this,arguments);return C.has(i,n)?i[n]:i[n]=t.apply(this,arguments)}},C.delay=function(t,e){var i=o.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},C.defer=function(t){return C.delay.apply(C,[t,1].concat(o.call(arguments,1)))},C.throttle=function(t,e,i){var n,r,s,a=null,o=0;i||(i={});var h=function(){o=i.leading===!1?0:new Date,a=null,s=t.apply(n,r)};return function(){var l=new Date;o||i.leading!==!1||(o=l);var u=e-(l-o);return n=this,r=arguments,0>=u?(clearTimeout(a),a=null,o=l,s=t.apply(n,r)):a||i.trailing===!1||(a=setTimeout(h,u)),s}},C.debounce=function(t,e,i){var n,r,s,a,o;return function(){s=this,r=arguments,a=new Date;var h=function(){var l=new Date-a;e>l?n=setTimeout(h,e-l):(n=null,i||(o=t.apply(s,r)))},l=i&&!n;return n||(n=setTimeout(h,e)),l&&(o=t.apply(s,r)),o}},C.once=function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}},C.wrap=function(t,e){return function(){var i=[t];return a.apply(i,arguments),e.apply(this,i)}},C.compose=function(){var t=arguments;return function(){for(var e=arguments,i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},C.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},C.keys=b||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)C.has(t,i)&&e.push(i);return e},C.values=function(t){for(var e=C.keys(t),i=e.length,n=new Array(i),r=0;i>r;r++)n[r]=t[e[r]];return n},C.pairs=function(t){for(var e=C.keys(t),i=e.length,n=new Array(i),r=0;i>r;r++)n[r]=[e[r],t[e[r]]];return n},C.invert=function(t){for(var e={},i=C.keys(t),n=0,r=i.length;r>n;n++)e[t[i[n]]]=i[n];return e},C.functions=C.methods=function(t){var e=[];for(var i in t)C.isFunction(t[i])&&e.push(i);return e.sort()},C.extend=function(t){return S(o.call(arguments,1),function(e){if(e)for(var i in e)t[i]=e[i]}),t},C.pick=function(t){var e={},i=h.apply(n,o.call(arguments,1));return S(i,function(i){i in t&&(e[i]=t[i])}),e},C.omit=function(t){var e={},i=h.apply(n,o.call(arguments,1));for(var r in t)C.contains(i,r)||(e[r]=t[r]);return e},C.defaults=function(t){return S(o.call(arguments,1),function(e){if(e)for(var i in e)void 0===t[i]&&(t[i]=e[i])}),t},C.clone=function(t){return C.isObject(t)?C.isArray(t)?t.slice():C.extend({},t):t},C.tap=function(t,e){return e(t),t};var A=function(t,e,i,n){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof C&&(t=t._wrapped),e instanceof C&&(e=e._wrapped);var r=l.call(t);if(r!=l.call(e))return!1;switch(r){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=i.length;s--;)if(i[s]==t)return n[s]==e;var a=t.constructor,o=e.constructor;if(a!==o&&!(C.isFunction(a)&&a instanceof a&&C.isFunction(o)&&o instanceof o))return!1;i.push(t),n.push(e);var h=0,u=!0;if("[object Array]"==r){if(h=t.length,u=h==e.length)for(;h--&&(u=A(t[h],e[h],i,n)););}else{for(var c in t)if(C.has(t,c)&&(h++,!(u=C.has(e,c)&&A(t[c],e[c],i,n))))break;if(u){for(c in e)if(C.has(e,c)&&!h--)break;u=!h}}return i.pop(),n.pop(),u};C.isEqual=function(t,e){return A(t,e,[],[])},C.isEmpty=function(t){if(null==t)return!0;if(C.isArray(t)||C.isString(t))return 0===t.length;for(var e in t)if(C.has(t,e))return!1;return!0},C.isElement=function(t){return!(!t||1!==t.nodeType)},C.isArray=w||function(t){return"[object Array]"==l.call(t)},C.isObject=function(t){return t===Object(t)},S(["Arguments","Function","String","Number","Date","RegExp"],function(t){C["is"+t]=function(e){return l.call(e)=="[object "+t+"]"}}),C.isArguments(arguments)||(C.isArguments=function(t){return!(!t||!C.has(t,"callee"))}),"function"!=typeof/./&&(C.isFunction=function(t){return"function"==typeof t}),C.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},C.isNaN=function(t){return C.isNumber(t)&&t!=+t},C.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==l.call(t)},C.isNull=function(t){return null===t},C.isUndefined=function(t){return void 0===t},C.has=function(t,e){return u.call(t,e)},C.noConflict=function(){return t._=e,this},C.identity=function(t){return t},C.times=function(t,e,i){for(var n=Array(Math.max(0,t)),r=0;t>r;r++)n[r]=e.call(i,r);return n},C.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var I={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};I.unescape=C.invert(I.escape);var E={escape:new RegExp("["+C.keys(I.escape).join("")+"]","g"),unescape:new RegExp("("+C.keys(I.unescape).join("|")+")","g")};C.each(["escape","unescape"],function(t){C[t]=function(e){return null==e?"":(""+e).replace(E[t],function(e){return I[t][e]})}}),C.result=function(t,e){if(null==t)return void 0;var i=t[e];return C.isFunction(i)?i.call(t):i},C.mixin=function(t){S(C.functions(t),function(e){var i=C[e]=t[e];C.prototype[e]=function(){var t=[this._wrapped];return a.apply(t,arguments),F.call(this,i.apply(C,t))}})};var q=0;C.uniqueId=function(t){var e=++q+"";return t?t+e:e},C.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var O=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},W=/\\|'|\r|\n|\t|\u2028|\u2029/g;C.template=function(t,e,i){var n;i=C.defaults({},i,C.templateSettings);var r=new RegExp([(i.escape||O).source,(i.interpolate||O).source,(i.evaluate||O).source].join("|")+"|$","g"),s=0,a="__p+='";t.replace(r,function(e,i,n,r,o){return a+=t.slice(s,o).replace(W,function(t){return"\\"+P[t]}),i&&(a+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(a+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),r&&(a+="';\n"+r+"\n__p+='"),s=o+e.length,e}),a+="';\n",i.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(i.variable||"obj","_",a)}catch(o){throw o.source=a,o}if(e)return n(e,C);var h=function(t){return n.call(this,t,C)};return h.source="function("+(i.variable||"obj")+"){\n"+a+"}",h},C.chain=function(t){return C(t).chain()};var F=function(t){return this._chain?C(t).chain():t};C.mixin(C),S(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];C.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!=t&&"splice"!=t||0!==i.length||delete i[0],F.call(this,i)}}),S(["concat","join","slice"],function(t){var e=n[t];C.prototype[t]=function(){return F.call(this,e.apply(this._wrapped,arguments))}}),C.extend(C.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),function(){{var t,e=this,i=e.Backbone,n=[],r=(n.push,n.slice);n.splice}t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="1.1.0";var s=e._;s||"undefined"==typeof require||(s=require("underscore")),t.$=e.jQuery||e.Zepto||e.ender||e.$,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a=t.Events={on:function(t,e,i){if(!h(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var n=this._events[t]||(this._events[t]=[]);return n.push({callback:e,context:i,ctx:i||this}),this},once:function(t,e,i){if(!h(this,"once",t,[e,i])||!e)return this;var n=this,r=s.once(function(){n.off(t,r),e.apply(this,arguments)});return r._callback=e,this.on(t,r,i)},off:function(t,e,i){var n,r,a,o,l,u,c,p;if(!this._events||!h(this,"off",t,[e,i]))return this;if(!t&&!e&&!i)return this._events={},this;for(o=t?[t]:s.keys(this._events),l=0,u=o.length;u>l;l++)if(t=o[l],a=this._events[t]){if(this._events[t]=n=[],e||i)for(c=0,p=a.length;p>c;c++)r=a[c],(e&&e!==r.callback&&e!==r.callback._callback||i&&i!==r.context)&&n.push(r);n.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=r.call(arguments,1);if(!h(this,"trigger",t,e))return this;var i=this._events[t],n=this._events.all;return i&&l(i,e),n&&l(n,arguments),this},stopListening:function(t,e,i){var n=this._listeningTo;if(!n)return this;var r=!e&&!i;i||"object"!=typeof e||(i=this),t&&((n={})[t._listenId]=t);for(var a in n)t=n[a],t.off(e,i,this),(r||s.isEmpty(t._events))&&delete this._listeningTo[a];return this}},o=/\s+/,h=function(t,e,i,n){if(!i)return!0;if("object"==typeof i){for(var r in i)t[e].apply(t,[r,i[r]].concat(n));return!1}if(o.test(i)){for(var s=i.split(o),a=0,h=s.length;h>a;a++)t[e].apply(t,[s[a]].concat(n));return!1}return!0},l=function(t,e){var i,n=-1,r=t.length,s=e[0],a=e[1],o=e[2];switch(e.length){case 0:for(;++n<r;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s);return;case 2:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s,a);return;case 3:for(;++n<r;)(i=t[n]).callback.call(i.ctx,s,a,o);return;default:for(;++n<r;)(i=t[n]).callback.apply(i.ctx,e)}},u={listenTo:"on",listenToOnce:"once"};s.each(u,function(t,e){a[e]=function(e,i,n){var r=this._listeningTo||(this._listeningTo={}),a=e._listenId||(e._listenId=s.uniqueId("l"));return r[a]=e,n||"object"!=typeof i||(n=this),e[t](i,n,this),this}}),a.bind=a.on,a.unbind=a.off,s.extend(t,a);var c=t.Model=function(t,e){var i=t||{};e||(e={}),this.cid=s.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{}),i=s.defaults({},i,s.result(this,"defaults")),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};s.extend(c.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return s.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return s.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,i){var n,r,a,o,h,l,u,c;if(null==t)return this;if("object"==typeof t?(r=t,i=e):(r={})[t]=e,i||(i={}),!this._validate(r,i))return!1;a=i.unset,h=i.silent,o=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=s.clone(this.attributes),this.changed={}),c=this.attributes,u=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]);for(n in r)e=r[n],s.isEqual(c[n],e)||o.push(n),s.isEqual(u[n],e)?delete this.changed[n]:this.changed[n]=e,a?delete c[n]:c[n]=e;if(!h){o.length&&(this._pending=!0);for(var p=0,g=o.length;g>p;p++)this.trigger("change:"+o[p],this,c[o[p]],i)}if(l)return this;if(!h)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,s.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,s.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!s.isEmpty(this.changed):s.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?s.clone(this.changed):!1;var e,i=!1,n=this._changing?this._previousAttributes:this.attributes;for(var r in t)s.isEqual(n[r],e=t[r])||((i||(i={}))[r]=e);return i},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return s.clone(this._previousAttributes)},fetch:function(t){t=t?s.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=this,i=t.success;return t.success=function(n){return e.set(e.parse(n,t),t)?(i&&i(e,n,t),void e.trigger("sync",e,n,t)):!1},P(this,t),this.sync("read",this,t)},save:function(t,e,i){var n,r,a,o=this.attributes;if(null==t||"object"==typeof t?(n=t,i=e):(n={})[t]=e,i=s.extend({validate:!0},i),n&&!i.wait){if(!this.set(n,i))return!1}else if(!this._validate(n,i))return!1;n&&i.wait&&(this.attributes=s.extend({},o,n)),void 0===i.parse&&(i.parse=!0);var h=this,l=i.success;return i.success=function(t){h.attributes=o;var e=h.parse(t,i);return i.wait&&(e=s.extend(n||{},e)),s.isObject(e)&&!h.set(e,i)?!1:(l&&l(h,t,i),void h.trigger("sync",h,t,i))},P(this,i),r=this.isNew()?"create":i.patch?"patch":"update","patch"===r&&(i.attrs=n),a=this.sync(r,this,i),n&&i.wait&&(this.attributes=o),a},destroy:function(t){t=t?s.clone(t):{};var e=this,i=t.success,n=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(r){(t.wait||e.isNew())&&n(),i&&i(e,r,t),e.isNew()||e.trigger("sync",e,r,t)},this.isNew())return t.success(),!1;P(this,t);var r=this.sync("delete",this,t);return t.wait||n(),r},url:function(){var t=s.result(this,"urlRoot")||s.result(this.collection,"url")||O();return this.isNew()?t:t+("/"===t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(t){return this._validate({},s.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=s.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;return i?(this.trigger("invalid",this,i,s.extend(e,{validationError:i})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];s.each(p,function(t){c.prototype[t]=function(){var e=r.call(arguments);return e.unshift(this.attributes),s[t].apply(s,e)}});var g=t.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,s.extend({silent:!0},e))},f={add:!0,remove:!0,merge:!0},d={add:!0,remove:!1};s.extend(g.prototype,a,{model:c,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return t.sync.apply(this,arguments)},add:function(t,e){return this.set(t,s.extend({merge:!1},e,d))},remove:function(t,e){var i=!s.isArray(t);t=i?[t]:s.clone(t),e||(e={});var n,r,a,o;for(n=0,r=t.length;r>n;n++)o=t[n]=this.get(t[n]),o&&(delete this._byId[o.id],delete this._byId[o.cid],a=this.indexOf(o),this.models.splice(a,1),this.length--,e.silent||(e.index=a,o.trigger("remove",o,this,e)),this._removeReference(o));return i?t[0]:t},set:function(t,e){e=s.defaults({},e,f),e.parse&&(t=this.parse(t,e));var i=!s.isArray(t);t=i?t?[t]:[]:s.clone(t);var n,r,a,o,h,l,u,p=e.at,g=this.model,d=this.comparator&&null==p&&e.sort!==!1,v=s.isString(this.comparator)?this.comparator:null,m=[],y=[],x={},w=e.add,b=e.merge,_=e.remove,C=!d&&w&&_?[]:!1;for(n=0,r=t.length;r>n;n++){if(h=t[n],a=h instanceof c?o=h:h[g.prototype.idAttribute],l=this.get(a))_&&(x[l.cid]=!0),b&&(h=h===o?o.attributes:h,e.parse&&(h=l.parse(h,e)),l.set(h,e),d&&!u&&l.hasChanged(v)&&(u=!0)),t[n]=l;else if(w){if(o=t[n]=this._prepareModel(h,e),!o)continue;m.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,null!=o.id&&(this._byId[o.id]=o)}C&&C.push(l||o)}if(_){for(n=0,r=this.length;r>n;++n)x[(o=this.models[n]).cid]||y.push(o);y.length&&this.remove(y,e)}if(m.length||C&&C.length)if(d&&(u=!0),this.length+=m.length,null!=p)for(n=0,r=m.length;r>n;n++)this.models.splice(p+n,0,m[n]);else{C&&(this.models.length=0);var S=C||m;for(n=0,r=S.length;r>n;n++)this.models.push(S[n])}if(u&&this.sort({silent:!0}),!e.silent){for(n=0,r=m.length;r>n;n++)(o=m[n]).trigger("add",o,this,e);(u||C&&C.length)&&this.trigger("sort",this,e)}return i?t[0]:t},reset:function(t,e){e||(e={});for(var i=0,n=this.models.length;n>i;i++)this._removeReference(this.models[i]);return e.previousModels=this.models,this._reset(),t=this.add(t,s.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,s.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,s.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return r.apply(this.models,arguments)},get:function(t){return null==t?void 0:this._byId[t.id]||this._byId[t.cid]||this._byId[t]},at:function(t){return this.models[t]},where:function(t,e){return s.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),s.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(s.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return s.invoke(this.models,"get",t)},fetch:function(t){t=t?s.clone(t):{},void 0===t.parse&&(t.parse=!0);var e=t.success,i=this;return t.success=function(n){var r=t.reset?"reset":"set";i[r](n,t),e&&e(i,n,t),i.trigger("sync",i,n,t)},P(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?s.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var i=this,n=e.success;return e.success=function(t,e,r){r.wait&&i.add(t,r),n&&n(t,e,r)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof c)return t.collection||(t.collection=this),t;e=e?s.clone(e):{},e.collection=this;var i=new this.model(t,e);return i.validationError?(this.trigger("invalid",this,i.validationError,e),!1):i},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!==t&&"remove"!==t||i===this)&&("destroy"===t&&this.remove(e,n),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var v=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];s.each(v,function(t){g.prototype[t]=function(){var e=r.call(arguments);return e.unshift(this.models),s[t].apply(s,e)}});var m=["groupBy","countBy","sortBy"];s.each(m,function(t){g.prototype[t]=function(e,i){var n=s.isFunction(e)?e:function(t){return t.get(e)};return s[t](this.models,n,i)}});var y=t.View=function(t){this.cid=s.uniqueId("view"),t||(t={}),s.extend(this,s.pick(t,w)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},x=/^(\S+)\s*(.*)$/,w=["model","collection","el","id","attributes","className","tagName","events"];s.extend(y.prototype,a,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,i){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=s.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var i=t[e];if(s.isFunction(i)||(i=this[t[e]]),i){var n=e.match(x),r=n[1],a=n[2];i=s.bind(i,this),r+=".delegateEvents"+this.cid,""===a?this.$el.on(r,i):this.$el.on(r,a,i)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(s.result(this,"el"),!1);else{var e=s.extend({},s.result(this,"attributes"));this.id&&(e.id=s.result(this,"id")),this.className&&(e["class"]=s.result(this,"className"));var i=t.$("<"+s.result(this,"tagName")+">").attr(e);this.setElement(i,!1)}}}),t.sync=function(e,i,n){var r=_[e];s.defaults(n||(n={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var a={type:r,dataType:"json"};if(n.url||(a.url=s.result(i,"url")||O()),null!=n.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(n.attrs||i.toJSON(n))),n.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),n.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){a.type="POST",n.emulateJSON&&(a.data._method=r);var o=n.beforeSend;n.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",r),o?o.apply(this,arguments):void 0}}"GET"===a.type||n.emulateJSON||(a.processData=!1),"PATCH"===a.type&&b&&(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var h=n.xhr=t.ajax(s.extend(a,n));return i.trigger("request",i,h,n),h};var b=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),_={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},S=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,R=/\*\w+/g,M=/[\-{}\[\]+?.,\\\^$|#\s]/g;s.extend(C.prototype,a,{initialize:function(){},route:function(e,i,n){s.isRegExp(e)||(e=this._routeToRegExp(e)),s.isFunction(i)&&(n=i,i=""),n||(n=this[i]);var r=this;return t.history.route(e,function(s){var a=r._extractParameters(e,s);n&&n.apply(r,a),r.trigger.apply(r,["route:"+i].concat(a)),r.trigger("route",i,a),t.history.trigger("route",r,i,a)}),this},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=s.result(this,"routes");for(var t,e=s.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(M,"\\$&").replace(S,"(?:$1)?").replace(k,function(t,e){return e?t:"([^/]+)"}).replace(R,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return s.map(i,function(t){return t?decodeURIComponent(t):null})}});var H=t.History=function(){this.handlers=[],s.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},T=/^[#\/]|\s+$/g,j=/^\/+|\/+$/g,A=/msie [\w.]+/,I=/\/$/,E=/[?#].*$/;H.started=!1,s.extend(H.prototype,a,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var i=this.root.replace(I,"");t.indexOf(i)||(t=t.slice(i.length))}else t=this.getHash();return t.replace(T,"")},start:function(e){if(H.started)throw new Error("Backbone.history has already been started");H.started=!0,this.options=s.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment(),n=document.documentMode,r=A.exec(navigator.userAgent.toLowerCase())&&(!n||7>=n);this.root=("/"+this.root+"/").replace(j,"/"),r&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(i)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=i;var a=this.location,o=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!o)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&o&&a.hash&&(this.fragment=this.getHash().replace(T,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search))}return this.options.silent?void 0:this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),H.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment?!1:(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(t){return t=this.fragment=this.getFragment(t),s.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0})},navigate:function(t,e){if(!H.started)return!1;e&&e!==!0||(e={trigger:!!e});var i=this.root+(t=this.getFragment(t||""));if(t=t.replace(E,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);
this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),t.history=new H;var q=function(t,e){var i,n=this;i=t&&s.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},s.extend(i,n,e);var r=function(){this.constructor=i};return r.prototype=n.prototype,i.prototype=new r,t&&s.extend(i.prototype,t),i.__super__=n.prototype,i};c.extend=g.extend=C.extend=y.extend=H.extend=q;var O=function(){throw new Error('A "url" property or function must be specified')},P=function(t,e){var i=e.error;e.error=function(n){i&&i(t,n,e),t.trigger("error",t,n,e)}}}.call(this),function(t,e,i){!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):jQuery&&!jQuery.fn.sparkline&&t(jQuery)}(function(n){"use strict";var r,s,a,o,h,l,u,c,p,g,f,d,v,m,y,x,w,b,_,C,S,k,R,M,H,T,j,A,I,E,q,O,P={},W=0;r=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:i,normalRangeMax:i,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:i,chartRangeMax:i,chartRangeMinX:i,chartRangeMaxX:i,tooltipFormat:new a('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:i,nullColor:i,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:i,chartRangeMin:i,chartRangeClip:!1,colorMap:i,tooltipFormat:new a('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new a('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:i,thresholdValue:0,chartRangeMax:i,chartRangeMin:i,chartRangeClip:!1,tooltipFormat:new a("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:i,tooltipFormat:new a("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new a('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:i,targetColor:"#4a2",chartRangeMax:i,chartRangeMin:i,tooltipFormat:new a("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}},T='.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}',s=function(){var t,e;return t=function(){this.init.apply(this,arguments)},arguments.length>1?(arguments[0]?(t.prototype=n.extend(new arguments[0],arguments[arguments.length-1]),t._super=arguments[0].prototype):t.prototype=arguments[arguments.length-1],arguments.length>2&&(e=Array.prototype.slice.call(arguments,1,-1),e.unshift(t.prototype),n.extend.apply(n,e))):t.prototype=arguments[0],t.prototype.cls=t,t},n.SPFormatClass=a=s({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(t,e){this.format=t,this.fclass=e},render:function(t,e,n){var r,s,a,o,h,l=this,u=t;return this.format.replace(this.fre,function(){var t;return s=arguments[1],a=arguments[3],r=l.precre.exec(s),r?(h=r[2],s=r[1]):h=!1,o=u[s],o===i?"":a&&e&&e[a]?(t=e[a],t.get?e[a].get(o)||o:e[a][o]||o):(p(o)&&(o=n.get("numberFormatter")?n.get("numberFormatter")(o):m(o,h,n.get("numberDigitGroupCount"),n.get("numberDigitGroupSep"),n.get("numberDecimalMark"))),o)})}}),n.spformat=function(t,e){return new a(t,e)},o=function(t,e,i){return e>t?e:t>i?i:t},h=function(t,i){var n;return 2===i?(n=e.floor(t.length/2),t.length%2?t[n]:(t[n-1]+t[n])/2):t.length%2?(n=(t.length*i+i)/4,n%1?(t[e.floor(n)]+t[e.floor(n)-1])/2:t[n-1]):(n=(t.length*i+2)/4,n%1?(t[e.floor(n)]+t[e.floor(n)-1])/2:t[n-1])},l=function(t){var e;switch(t){case"undefined":t=i;break;case"null":t=null;break;case"true":t=!0;break;case"false":t=!1;break;default:e=parseFloat(t),t==e&&(t=e)}return t},u=function(t){var e,i=[];for(e=t.length;e--;)i[e]=l(t[e]);return i},c=function(t,e){var i,n,r=[];for(i=0,n=t.length;n>i;i++)t[i]!==e&&r.push(t[i]);return r},p=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},m=function(t,e,i,r,s){var a,o;for(t=(e===!1?parseFloat(t).toString():t.toFixed(e)).split(""),a=(a=n.inArray(".",t))<0?t.length:a,a<t.length&&(t[a]=s),o=a-i;o>0;o-=i)t.splice(o,0,r);return t.join("")},g=function(t,e,i){var n;for(n=e.length;n--;)if((!i||null!==e[n])&&e[n]!==t)return!1;return!0},f=function(t){var e,i=0;for(e=t.length;e--;)i+="number"==typeof t[e]?t[e]:0;return i},v=function(t){return n.isArray(t)?t:[t]},d=function(e){var i;t.createStyleSheet?t.createStyleSheet().cssText=e:(i=t.createElement("style"),i.type="text/css",t.getElementsByTagName("head")[0].appendChild(i),i["string"==typeof t.body.style.WebkitAppearance?"innerText":"innerHTML"]=e)},n.fn.simpledraw=function(e,r,s,a){var o,h;if(s&&(o=this.data("_jqs_vcanvas")))return o;if(n.fn.sparkline.canvas===!1)return!1;if(n.fn.sparkline.canvas===i){var l=t.createElement("canvas");if(l.getContext&&l.getContext("2d"))n.fn.sparkline.canvas=function(t,e,i,n){return new E(t,e,i,n)};else{if(!t.namespaces||t.namespaces.v)return n.fn.sparkline.canvas=!1,!1;t.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),n.fn.sparkline.canvas=function(t,e,i){return new q(t,e,i)}}}return e===i&&(e=n(this).innerWidth()),r===i&&(r=n(this).innerHeight()),o=n.fn.sparkline.canvas(e,r,this,a),h=n(this).data("_jqs_mhandler"),h&&h.registerCanvas(o),o},n.fn.cleardraw=function(){var t=this.data("_jqs_vcanvas");t&&t.reset()},n.RangeMapClass=y=s({init:function(t){var e,i,n=[];for(e in t)t.hasOwnProperty(e)&&"string"==typeof e&&e.indexOf(":")>-1&&(i=e.split(":"),i[0]=0===i[0].length?-1/0:parseFloat(i[0]),i[1]=0===i[1].length?1/0:parseFloat(i[1]),i[2]=t[e],n.push(i));this.map=t,this.rangelist=n||!1},get:function(t){var e,n,r,s=this.rangelist;if((r=this.map[t])!==i)return r;if(s)for(e=s.length;e--;)if(n=s[e],n[0]<=t&&n[1]>=t)return n[2];return i}}),n.range_map=function(t){return new y(t)},x=s({init:function(t,e){var i=n(t);this.$el=i,this.options=e,this.currentPageX=0,this.currentPageY=0,this.el=t,this.splist=[],this.tooltip=null,this.over=!1,this.displayTooltips=!e.get("disableTooltips"),this.highlightEnabled=!e.get("disableHighlight")},registerSparkline:function(t){this.splist.push(t),this.over&&this.updateDisplay()},registerCanvas:function(t){var e=n(t.canvas);this.canvas=t,this.$canvas=e,e.mouseenter(n.proxy(this.mouseenter,this)),e.mouseleave(n.proxy(this.mouseleave,this)),e.click(n.proxy(this.mouseclick,this))},reset:function(t){this.splist=[],this.tooltip&&t&&(this.tooltip.remove(),this.tooltip=i)},mouseclick:function(t){var e=n.Event("sparklineClick");e.originalEvent=t,e.sparklines=this.splist,this.$el.trigger(e)},mouseenter:function(e){n(t.body).unbind("mousemove.jqs"),n(t.body).bind("mousemove.jqs",n.proxy(this.mousemove,this)),this.over=!0,this.currentPageX=e.pageX,this.currentPageY=e.pageY,this.currentEl=e.target,!this.tooltip&&this.displayTooltips&&(this.tooltip=new w(this.options),this.tooltip.updatePosition(e.pageX,e.pageY)),this.updateDisplay()},mouseleave:function(){n(t.body).unbind("mousemove.jqs");var e,i,r=this.splist,s=r.length,a=!1;for(this.over=!1,this.currentEl=null,this.tooltip&&(this.tooltip.remove(),this.tooltip=null),i=0;s>i;i++)e=r[i],e.clearRegionHighlight()&&(a=!0);a&&this.canvas.render()},mousemove:function(t){this.currentPageX=t.pageX,this.currentPageY=t.pageY,this.currentEl=t.target,this.tooltip&&this.tooltip.updatePosition(t.pageX,t.pageY),this.updateDisplay()},updateDisplay:function(){var t,e,i,r,s,a=this.splist,o=a.length,h=!1,l=this.$canvas.offset(),u=this.currentPageX-l.left,c=this.currentPageY-l.top;if(this.over){for(i=0;o>i;i++)e=a[i],r=e.setRegionHighlight(this.currentEl,u,c),r&&(h=!0);if(h){if(s=n.Event("sparklineRegionChange"),s.sparklines=this.splist,this.$el.trigger(s),this.tooltip){for(t="",i=0;o>i;i++)e=a[i],t+=e.getCurrentRegionTooltip();this.tooltip.setContent(t)}this.disableHighlight||this.canvas.render()}null===r&&this.mouseleave()}}}),w=s({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(e){var i,r=e.get("tooltipClassname","jqstooltip"),s=this.sizeStyle;this.container=e.get("tooltipContainer")||t.body,this.tooltipOffsetX=e.get("tooltipOffsetX",10),this.tooltipOffsetY=e.get("tooltipOffsetY",12),n("#jqssizetip").remove(),n("#jqstooltip").remove(),this.sizetip=n("<div/>",{id:"jqssizetip",style:s,"class":r}),this.tooltip=n("<div/>",{id:"jqstooltip","class":r}).appendTo(this.container),i=this.tooltip.offset(),this.offsetLeft=i.left,this.offsetTop=i.top,this.hidden=!0,n(window).unbind("resize.jqs scroll.jqs"),n(window).bind("resize.jqs scroll.jqs",n.proxy(this.updateWindowDims,this)),this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=n(window).scrollTop(),this.scrollLeft=n(window).scrollLeft(),this.scrollRight=this.scrollLeft+n(window).width(),this.updatePosition()},getSize:function(t){this.sizetip.html(t).appendTo(this.container),this.width=this.sizetip.width()+1,this.height=this.sizetip.height(),this.sizetip.remove()},setContent:function(t){return t?(this.getSize(t),this.tooltip.html(t).css({width:this.width,height:this.height,visibility:"visible"}),this.hidden&&(this.hidden=!1,this.updatePosition()),void 0):(this.tooltip.css("visibility","hidden"),void(this.hidden=!0))},updatePosition:function(t,e){if(t===i){if(this.mousex===i)return;t=this.mousex-this.offsetLeft,e=this.mousey-this.offsetTop}else this.mousex=t-=this.offsetLeft,this.mousey=e-=this.offsetTop;this.height&&this.width&&!this.hidden&&(e-=this.height+this.tooltipOffsetY,t+=this.tooltipOffsetX,e<this.scrollTop&&(e=this.scrollTop),t<this.scrollLeft?t=this.scrollLeft:t+this.width>this.scrollRight&&(t=this.scrollRight-this.width),this.tooltip.css({left:t,top:e}))},remove:function(){this.tooltip.remove(),this.sizetip.remove(),this.sizetip=this.tooltip=i,n(window).unbind("resize.jqs scroll.jqs")}}),j=function(){d(T)},n(j),O=[],n.fn.sparkline=function(e,r){return this.each(function(){var s,a,o=new n.fn.sparkline.options(this,r),h=n(this);if(s=function(){var r,s,a,l,u,c,p;return"html"===e||e===i?(p=this.getAttribute(o.get("tagValuesAttribute")),(p===i||null===p)&&(p=h.html()),r=p.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")):r=e,s="auto"===o.get("width")?r.length*o.get("defaultPixelsPerValue"):o.get("width"),"auto"===o.get("height")?o.get("composite")&&n.data(this,"_jqs_vcanvas")||(l=t.createElement("span"),l.innerHTML="a",h.html(l),a=n(l).innerHeight()||n(l).height(),n(l).remove(),l=null):a=o.get("height"),o.get("disableInteraction")?u=!1:(u=n.data(this,"_jqs_mhandler"),u?o.get("composite")||u.reset():(u=new x(this,o),n.data(this,"_jqs_mhandler",u))),o.get("composite")&&!n.data(this,"_jqs_vcanvas")?void(n.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),n.data(this,"_jqs_errnotify",!0))):(c=new(n.fn.sparkline[o.get("type")])(this,r,o,s,a),c.render(),u&&u.registerSparkline(c),void 0)},n(this).html()&&!o.get("disableHiddenCheck")&&n(this).is(":hidden")||!n(this).parents("body").length){if(!o.get("composite")&&n.data(this,"_jqs_pending"))for(a=O.length;a;a--)O[a-1][0]==this&&O.splice(a-1,1);O.push([this,s]),n.data(this,"_jqs_pending",!0)}else s.call(this)})},n.fn.sparkline.defaults=r(),n.sparkline_display_visible=function(){var t,e,i,r=[];for(e=0,i=O.length;i>e;e++)t=O[e][0],n(t).is(":visible")&&!n(t).parents().is(":hidden")?(O[e][1].call(t),n.data(O[e][0],"_jqs_pending",!1),r.push(e)):!n(t).closest("html").length&&!n.data(t,"_jqs_pending")&&(n.data(O[e][0],"_jqs_pending",!1),r.push(e));for(e=r.length;e;e--)O.splice(r[e-1],1)},n.fn.sparkline.options=s({init:function(t,e){var i,r,s,a;this.userOptions=e=e||{},this.tag=t,this.tagValCache={},r=n.fn.sparkline.defaults,s=r.common,this.tagOptionsPrefix=e.enableTagOptions&&(e.tagOptionsPrefix||s.tagOptionsPrefix),a=this.getTagSetting("type"),i=a===P?r[e.type||s.type]:r[a],this.mergedOptions=n.extend({},s,i,e)},getTagSetting:function(t){var e,n,r,s,a=this.tagOptionsPrefix;if(a===!1||a===i)return P;if(this.tagValCache.hasOwnProperty(t))e=this.tagValCache.key;else{if(e=this.tag.getAttribute(a+t),e===i||null===e)e=P;else if("["===e.substr(0,1))for(e=e.substr(1,e.length-2).split(","),n=e.length;n--;)e[n]=l(e[n].replace(/(^\s*)|(\s*$)/g,""));else if("{"===e.substr(0,1))for(r=e.substr(1,e.length-2).split(","),e={},n=r.length;n--;)s=r[n].split(":",2),e[s[0].replace(/(^\s*)|(\s*$)/g,"")]=l(s[1].replace(/(^\s*)|(\s*$)/g,""));else e=l(e);this.tagValCache.key=e}return e},get:function(t,e){var n,r=this.getTagSetting(t);return r!==P?r:(n=this.mergedOptions[t])===i?e:n}}),n.fn.sparkline._base=s({disabled:!1,init:function(t,e,r,s,a){this.el=t,this.$el=n(t),this.values=e,this.options=r,this.width=s,this.height=a,this.currentRegion=i},initTarget:function(){var t=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),t))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return this.disabled?(this.el.innerHTML="",!1):!0},getRegion:function(){},setRegionHighlight:function(t,e,n){var r,s=this.currentRegion,a=!this.options.get("disableHighlight");return e>this.canvasWidth||n>this.canvasHeight||0>e||0>n?null:(r=this.getRegion(t,e,n),s!==r?(s!==i&&a&&this.removeHighlight(),this.currentRegion=r,r!==i&&a&&this.renderHighlight(),!0):!1)},clearRegionHighlight:function(){return this.currentRegion!==i?(this.removeHighlight(),this.currentRegion=i,!0):!1},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(){},getCurrentRegionTooltip:function(){var t,e,r,s,o,h,l,u,c,p,g,f,d,v,m=this.options,y="",x=[];if(this.currentRegion===i)return"";if(t=this.getCurrentRegionFields(),g=m.get("tooltipFormatter"))return g(this,m,t);if(m.get("tooltipChartTitle")&&(y+='<div class="jqs jqstitle">'+m.get("tooltipChartTitle")+"</div>\n"),e=this.options.get("tooltipFormat"),!e)return"";if(n.isArray(e)||(e=[e]),n.isArray(t)||(t=[t]),l=this.options.get("tooltipFormatFieldlist"),u=this.options.get("tooltipFormatFieldlistKey"),l&&u){for(c=[],h=t.length;h--;)p=t[h][u],-1!=(v=n.inArray(p,l))&&(c[v]=t[h]);t=c}for(r=e.length,d=t.length,h=0;r>h;h++)for(f=e[h],"string"==typeof f&&(f=new a(f)),s=f.fclass||"jqsfield",v=0;d>v;v++)t[v].isNull&&m.get("tooltipSkipNull")||(n.extend(t[v],{prefix:m.get("tooltipPrefix"),suffix:m.get("tooltipSuffix")}),o=f.render(t[v],m.get("tooltipValueLookups"),m),x.push('<div class="'+s+'">'+o+"</div>"));return x.length?y+x.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(t,i){var n,r,s,a,h=i.get("highlightColor"),l=i.get("highlightLighten");if(h)return h;if(l&&(n=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(t))){for(s=[],r=4===t.length?16:1,a=0;3>a;a++)s[a]=o(e.round(parseInt(n[a+1],16)*r*l),0,255);return"rgb("+s.join(",")+")"}return t}}),b={changeHighlight:function(t){var e,i=this.currentRegion,r=this.target,s=this.regionShapes[i];s&&(e=this.renderRegion(i,t),n.isArray(e)||n.isArray(s)?(r.replaceWithShapes(s,e),this.regionShapes[i]=n.map(e,function(t){return t.id})):(r.replaceWithShape(s,e),this.regionShapes[i]=e.id))},render:function(){var t,e,i,r,s=this.values,a=this.target,o=this.regionShapes;if(this.cls._super.render.call(this)){for(i=s.length;i--;)if(t=this.renderRegion(i))if(n.isArray(t)){for(e=[],r=t.length;r--;)t[r].append(),e.push(t[r].id);o[i]=e}else t.append(),o[i]=t.id;else o[i]=null;a.render()}}},n.fn.sparkline.line=_=s(n.fn.sparkline._base,{type:"line",init:function(t,e,i,n,r){_._super.init.call(this,t,e,i,n,r),this.vertices=[],this.regionMap=[],this.xvalues=[],this.yvalues=[],this.yminmax=[],this.hightlightSpotId=null,this.lastShapeId=null,this.initTarget()},getRegion:function(t,e){var n,r=this.regionMap;for(n=r.length;n--;)if(null!==r[n]&&e>=r[n][0]&&e<=r[n][1])return r[n][2];return i},getCurrentRegionFields:function(){var t=this.currentRegion;return{isNull:null===this.yvalues[t],x:this.xvalues[t],y:this.yvalues[t],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:t}},renderHighlight:function(){var t,e,n=this.currentRegion,r=this.target,s=this.vertices[n],a=this.options,o=a.get("spotRadius"),h=a.get("highlightSpotColor"),l=a.get("highlightLineColor");s&&(o&&h&&(t=r.drawCircle(s[0],s[1],o,i,h),this.highlightSpotId=t.id,r.insertAfterShape(this.lastShapeId,t)),l&&(e=r.drawLine(s[0],this.canvasTop,s[0],this.canvasTop+this.canvasHeight,l),this.highlightLineId=e.id,r.insertAfterShape(this.lastShapeId,e)))},removeHighlight:function(){var t=this.target;this.highlightSpotId&&(t.removeShapeId(this.highlightSpotId),this.highlightSpotId=null),this.highlightLineId&&(t.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){var t,i,n,r,s,a=this.values,o=a.length,h=this.xvalues,l=this.yvalues,u=this.yminmax;for(t=0;o>t;t++)i=a[t],n="string"==typeof a[t],r="object"==typeof a[t]&&a[t]instanceof Array,s=n&&a[t].split(":"),n&&2===s.length?(h.push(Number(s[0])),l.push(Number(s[1])),u.push(Number(s[1]))):r?(h.push(i[0]),l.push(i[1]),u.push(i[1])):(h.push(t),null===a[t]||"null"===a[t]?l.push(null):(l.push(Number(i)),u.push(Number(i))));this.options.get("xvalues")&&(h=this.options.get("xvalues")),this.maxy=this.maxyorg=e.max.apply(e,u),this.miny=this.minyorg=e.min.apply(e,u),this.maxx=e.max.apply(e,h),this.minx=e.min.apply(e,h),this.xvalues=h,this.yvalues=l,this.yminmax=u},processRangeOptions:function(){var t=this.options,e=t.get("normalRangeMin"),n=t.get("normalRangeMax");e!==i&&(e<this.miny&&(this.miny=e),n>this.maxy&&(this.maxy=n)),t.get("chartRangeMin")!==i&&(t.get("chartRangeClip")||t.get("chartRangeMin")<this.miny)&&(this.miny=t.get("chartRangeMin")),t.get("chartRangeMax")!==i&&(t.get("chartRangeClip")||t.get("chartRangeMax")>this.maxy)&&(this.maxy=t.get("chartRangeMax")),t.get("chartRangeMinX")!==i&&(t.get("chartRangeClipX")||t.get("chartRangeMinX")<this.minx)&&(this.minx=t.get("chartRangeMinX")),t.get("chartRangeMaxX")!==i&&(t.get("chartRangeClipX")||t.get("chartRangeMaxX")>this.maxx)&&(this.maxx=t.get("chartRangeMaxX"))},drawNormalRange:function(t,n,r,s,a){var o=this.options.get("normalRangeMin"),h=this.options.get("normalRangeMax"),l=n+e.round(r-r*((h-this.miny)/a)),u=e.round(r*(h-o)/a);this.target.drawRect(t,l,s,u,i,this.options.get("normalRangeColor")).append()},render:function(){var t,r,s,a,o,h,l,u,c,p,g,f,d,v,m,x,w,b,C,S,k,R,M,H,T,j=this.options,A=this.target,I=this.canvasWidth,E=this.canvasHeight,q=this.vertices,O=j.get("spotRadius"),P=this.regionMap;if(_._super.render.call(this)&&(this.scanValues(),this.processRangeOptions(),M=this.xvalues,H=this.yvalues,this.yminmax.length&&!(this.yvalues.length<2))){for(a=o=0,t=this.maxx-this.minx===0?1:this.maxx-this.minx,r=this.maxy-this.miny===0?1:this.maxy-this.miny,s=this.yvalues.length-1,O&&(4*O>I||4*O>E)&&(O=0),O&&(k=j.get("highlightSpotColor")&&!j.get("disableInteraction"),(k||j.get("minSpotColor")||j.get("spotColor")&&H[s]===this.miny)&&(E-=e.ceil(O)),(k||j.get("maxSpotColor")||j.get("spotColor")&&H[s]===this.maxy)&&(E-=e.ceil(O),a+=e.ceil(O)),(k||(j.get("minSpotColor")||j.get("maxSpotColor"))&&(H[0]===this.miny||H[0]===this.maxy))&&(o+=e.ceil(O),I-=e.ceil(O)),(k||j.get("spotColor")||j.get("minSpotColor")||j.get("maxSpotColor")&&(H[s]===this.miny||H[s]===this.maxy))&&(I-=e.ceil(O))),E--,j.get("normalRangeMin")!==i&&!j.get("drawNormalOnTop")&&this.drawNormalRange(o,a,E,I,r),l=[],u=[l],v=m=null,x=H.length,T=0;x>T;T++)c=M[T],g=M[T+1],p=H[T],f=o+e.round((c-this.minx)*(I/t)),d=x-1>T?o+e.round((g-this.minx)*(I/t)):I,m=f+(d-f)/2,P[T]=[v||0,m,T],v=m,null===p?T&&(null!==H[T-1]&&(l=[],u.push(l)),q.push(null)):(p<this.miny&&(p=this.miny),p>this.maxy&&(p=this.maxy),l.length||l.push([f,a+E]),h=[f,a+e.round(E-E*((p-this.miny)/r))],l.push(h),q.push(h));for(w=[],b=[],C=u.length,T=0;C>T;T++)l=u[T],l.length&&(j.get("fillColor")&&(l.push([l[l.length-1][0],a+E]),b.push(l.slice(0)),l.pop()),l.length>2&&(l[0]=[l[0][0],l[1][1]]),w.push(l));for(C=b.length,T=0;C>T;T++)A.drawShape(b[T],j.get("fillColor"),j.get("fillColor")).append();for(j.get("normalRangeMin")!==i&&j.get("drawNormalOnTop")&&this.drawNormalRange(o,a,E,I,r),C=w.length,T=0;C>T;T++)A.drawShape(w[T],j.get("lineColor"),i,j.get("lineWidth")).append();if(O&&j.get("valueSpots"))for(S=j.get("valueSpots"),S.get===i&&(S=new y(S)),T=0;x>T;T++)R=S.get(H[T]),R&&A.drawCircle(o+e.round((M[T]-this.minx)*(I/t)),a+e.round(E-E*((H[T]-this.miny)/r)),O,i,R).append();O&&j.get("spotColor")&&null!==H[s]&&A.drawCircle(o+e.round((M[M.length-1]-this.minx)*(I/t)),a+e.round(E-E*((H[s]-this.miny)/r)),O,i,j.get("spotColor")).append(),this.maxy!==this.minyorg&&(O&&j.get("minSpotColor")&&(c=M[n.inArray(this.minyorg,H)],A.drawCircle(o+e.round((c-this.minx)*(I/t)),a+e.round(E-E*((this.minyorg-this.miny)/r)),O,i,j.get("minSpotColor")).append()),O&&j.get("maxSpotColor")&&(c=M[n.inArray(this.maxyorg,H)],A.drawCircle(o+e.round((c-this.minx)*(I/t)),a+e.round(E-E*((this.maxyorg-this.miny)/r)),O,i,j.get("maxSpotColor")).append())),this.lastShapeId=A.getLastShapeId(),this.canvasTop=a,A.render()}}}),n.fn.sparkline.bar=C=s(n.fn.sparkline._base,b,{type:"bar",init:function(t,r,s,a,h){var p,g,f,d,v,m,x,w,b,_,S,k,R,M,H,T,j,A,I,E,q,O,P=parseInt(s.get("barWidth"),10),W=parseInt(s.get("barSpacing"),10),F=s.get("chartRangeMin"),L=s.get("chartRangeMax"),N=s.get("chartRangeClip"),$=1/0,B=-1/0;for(C._super.init.call(this,t,r,s,a,h),m=0,x=r.length;x>m;m++)E=r[m],p="string"==typeof E&&E.indexOf(":")>-1,(p||n.isArray(E))&&(H=!0,p&&(E=r[m]=u(E.split(":"))),E=c(E,null),g=e.min.apply(e,E),f=e.max.apply(e,E),$>g&&($=g),f>B&&(B=f));this.stacked=H,this.regionShapes={},this.barWidth=P,this.barSpacing=W,this.totalBarWidth=P+W,this.width=a=r.length*P+(r.length-1)*W,this.initTarget(),N&&(R=F===i?-1/0:F,M=L===i?1/0:L),v=[],d=H?[]:v;var V=[],z=[];for(m=0,x=r.length;x>m;m++)if(H)for(T=r[m],r[m]=I=[],V[m]=0,d[m]=z[m]=0,j=0,A=T.length;A>j;j++)E=I[j]=N?o(T[j],R,M):T[j],null!==E&&(E>0&&(V[m]+=E),0>$&&B>0?0>E?z[m]+=e.abs(E):d[m]+=E:d[m]+=e.abs(E-(0>E?B:$)),v.push(E));else E=N?o(r[m],R,M):r[m],E=r[m]=l(E),null!==E&&v.push(E);this.max=k=e.max.apply(e,v),this.min=S=e.min.apply(e,v),this.stackMax=B=H?e.max.apply(e,V):k,this.stackMin=$=H?e.min.apply(e,v):S,s.get("chartRangeMin")!==i&&(s.get("chartRangeClip")||s.get("chartRangeMin")<S)&&(S=s.get("chartRangeMin")),s.get("chartRangeMax")!==i&&(s.get("chartRangeClip")||s.get("chartRangeMax")>k)&&(k=s.get("chartRangeMax")),this.zeroAxis=b=s.get("zeroAxis",!0),_=0>=S&&k>=0&&b?0:0==b?S:S>0?S:k,this.xaxisOffset=_,w=H?e.max.apply(e,d)+e.max.apply(e,z):k-S,this.canvasHeightEf=b&&0>S?this.canvasHeight-2:this.canvasHeight-1,_>S?(O=H&&k>=0?B:k,q=(O-_)/w*this.canvasHeight,q!==e.ceil(q)&&(this.canvasHeightEf-=2,q=e.ceil(q))):q=this.canvasHeight,this.yoffset=q,n.isArray(s.get("colorMap"))?(this.colorMapByIndex=s.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=s.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===i&&(this.colorMapByValue=new y(this.colorMapByValue))),this.range=w},getRegion:function(t,n){var r=e.floor(n/this.totalBarWidth);return 0>r||r>=this.values.length?i:r},getCurrentRegionFields:function(){var t,e,i=this.currentRegion,n=v(this.values[i]),r=[];for(e=n.length;e--;)t=n[e],r.push({isNull:null===t,value:t,color:this.calcColor(e,t,i),offset:i});return r},calcColor:function(t,e,r){var s,a,o=this.colorMapByIndex,h=this.colorMapByValue,l=this.options;return s=l.get(this.stacked?"stackedBarColor":0>e?"negBarColor":"barColor"),0===e&&l.get("zeroColor")!==i&&(s=l.get("zeroColor")),h&&(a=h.get(e))?s=a:o&&o.length>r&&(s=o[r]),n.isArray(s)?s[t%s.length]:s},renderRegion:function(t,r){var s,a,o,h,l,u,c,p,f,d,v=this.values[t],m=this.options,y=this.xaxisOffset,x=[],w=this.range,b=this.stacked,_=this.target,C=t*this.totalBarWidth,S=this.canvasHeightEf,k=this.yoffset;if(v=n.isArray(v)?v:[v],c=v.length,p=v[0],h=g(null,v),d=g(y,v,!0),h)return m.get("nullColor")?(o=r?m.get("nullColor"):this.calcHighlightColor(m.get("nullColor"),m),s=k>0?k-1:k,_.drawRect(C,s,this.barWidth-1,0,o,o)):i;for(l=k,u=0;c>u;u++){if(p=v[u],b&&p===y){if(!d||f)continue;f=!0}a=w>0?e.floor(S*(e.abs(p-y)/w))+1:1,y>p||p===y&&0===k?(s=l,l+=a):(s=k-a,k-=a),o=this.calcColor(u,p,t),r&&(o=this.calcHighlightColor(o,m)),x.push(_.drawRect(C,s,this.barWidth-1,a-1,o,o))}return 1===x.length?x[0]:x}}),n.fn.sparkline.tristate=S=s(n.fn.sparkline._base,b,{type:"tristate",init:function(t,e,r,s,a){var o=parseInt(r.get("barWidth"),10),h=parseInt(r.get("barSpacing"),10);S._super.init.call(this,t,e,r,s,a),this.regionShapes={},this.barWidth=o,this.barSpacing=h,this.totalBarWidth=o+h,this.values=n.map(e,Number),this.width=s=e.length*o+(e.length-1)*h,n.isArray(r.get("colorMap"))?(this.colorMapByIndex=r.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=r.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===i&&(this.colorMapByValue=new y(this.colorMapByValue))),this.initTarget()},getRegion:function(t,i){return e.floor(i/this.totalBarWidth)},getCurrentRegionFields:function(){var t=this.currentRegion;return{isNull:this.values[t]===i,value:this.values[t],color:this.calcColor(this.values[t],t),offset:t}},calcColor:function(t,e){var i,n,r=this.values,s=this.options,a=this.colorMapByIndex,o=this.colorMapByValue;return i=o&&(n=o.get(t))?n:a&&a.length>e?a[e]:s.get(r[e]<0?"negBarColor":r[e]>0?"posBarColor":"zeroBarColor")},renderRegion:function(t,i){var n,r,s,a,o,h,l=this.values,u=this.options,c=this.target;return n=c.pixelHeight,s=e.round(n/2),a=t*this.totalBarWidth,l[t]<0?(o=s,r=s-1):l[t]>0?(o=0,r=s-1):(o=s-1,r=2),h=this.calcColor(l[t],t),null!==h?(i&&(h=this.calcHighlightColor(h,u)),c.drawRect(a,o,this.barWidth-1,r-1,h,h)):void 0}}),n.fn.sparkline.discrete=k=s(n.fn.sparkline._base,b,{type:"discrete",init:function(t,r,s,a,o){k._super.init.call(this,t,r,s,a,o),this.regionShapes={},this.values=r=n.map(r,Number),this.min=e.min.apply(e,r),this.max=e.max.apply(e,r),this.range=this.max-this.min,this.width=a="auto"===s.get("width")?2*r.length:this.width,this.interval=e.floor(a/r.length),this.itemWidth=a/r.length,s.get("chartRangeMin")!==i&&(s.get("chartRangeClip")||s.get("chartRangeMin")<this.min)&&(this.min=s.get("chartRangeMin")),s.get("chartRangeMax")!==i&&(s.get("chartRangeClip")||s.get("chartRangeMax")>this.max)&&(this.max=s.get("chartRangeMax")),this.initTarget(),this.target&&(this.lineHeight="auto"===s.get("lineHeight")?e.round(.3*this.canvasHeight):s.get("lineHeight"))},getRegion:function(t,i){return e.floor(i/this.itemWidth)},getCurrentRegionFields:function(){var t=this.currentRegion;return{isNull:this.values[t]===i,value:this.values[t],offset:t}},renderRegion:function(t,i){var n,r,s,a,h=this.values,l=this.options,u=this.min,c=this.max,p=this.range,g=this.interval,f=this.target,d=this.canvasHeight,v=this.lineHeight,m=d-v;return r=o(h[t],u,c),a=t*g,n=e.round(m-m*((r-u)/p)),s=l.get(l.get("thresholdColor")&&r<l.get("thresholdValue")?"thresholdColor":"lineColor"),i&&(s=this.calcHighlightColor(s,l)),f.drawLine(a,n,a,n+v,s)}}),n.fn.sparkline.bullet=R=s(n.fn.sparkline._base,{type:"bullet",init:function(t,n,r,s,a){var o,h,l;R._super.init.call(this,t,n,r,s,a),this.values=n=u(n),l=n.slice(),l[0]=null===l[0]?l[2]:l[0],l[1]=null===n[1]?l[2]:l[1],o=e.min.apply(e,n),h=e.max.apply(e,n),o=r.get("base")===i?0>o?o:0:r.get("base"),this.min=o,this.max=h,this.range=h-o,this.shapes={},this.valueShapes={},this.regiondata={},this.width=s="auto"===r.get("width")?"4.0em":s,this.target=this.$el.simpledraw(s,a,r.get("composite")),n.length||(this.disabled=!0),this.initTarget()},getRegion:function(t,e,n){var r=this.target.getShapeAt(t,e,n);return r!==i&&this.shapes[r]!==i?this.shapes[r]:i},getCurrentRegionFields:function(){var t=this.currentRegion;return{fieldkey:t.substr(0,1),value:this.values[t.substr(1)],region:t}},changeHighlight:function(t){var e,i=this.currentRegion,n=this.valueShapes[i];switch(delete this.shapes[n],i.substr(0,1)){case"r":e=this.renderRange(i.substr(1),t);break;case"p":e=this.renderPerformance(t);break;case"t":e=this.renderTarget(t)}this.valueShapes[i]=e.id,this.shapes[e.id]=i,this.target.replaceWithShape(n,e)},renderRange:function(t,i){var n=this.values[t],r=e.round(this.canvasWidth*((n-this.min)/this.range)),s=this.options.get("rangeColors")[t-2];return i&&(s=this.calcHighlightColor(s,this.options)),this.target.drawRect(0,0,r-1,this.canvasHeight-1,s,s)},renderPerformance:function(t){var i=this.values[1],n=e.round(this.canvasWidth*((i-this.min)/this.range)),r=this.options.get("performanceColor");return t&&(r=this.calcHighlightColor(r,this.options)),this.target.drawRect(0,e.round(.3*this.canvasHeight),n-1,e.round(.4*this.canvasHeight)-1,r,r)},renderTarget:function(t){var i=this.values[0],n=e.round(this.canvasWidth*((i-this.min)/this.range)-this.options.get("targetWidth")/2),r=e.round(.1*this.canvasHeight),s=this.canvasHeight-2*r,a=this.options.get("targetColor");return t&&(a=this.calcHighlightColor(a,this.options)),this.target.drawRect(n,r,this.options.get("targetWidth")-1,s-1,a,a)},render:function(){var t,e,i=this.values.length,n=this.target;if(R._super.render.call(this)){for(t=2;i>t;t++)e=this.renderRange(t).append(),this.shapes[e.id]="r"+t,this.valueShapes["r"+t]=e.id;null!==this.values[1]&&(e=this.renderPerformance().append(),this.shapes[e.id]="p1",this.valueShapes.p1=e.id),null!==this.values[0]&&(e=this.renderTarget().append(),this.shapes[e.id]="t0",this.valueShapes.t0=e.id),n.render()}}}),n.fn.sparkline.pie=M=s(n.fn.sparkline._base,{type:"pie",init:function(t,i,r,s,a){var o,h=0;if(M._super.init.call(this,t,i,r,s,a),this.shapes={},this.valueShapes={},this.values=i=n.map(i,Number),"auto"===r.get("width")&&(this.width=this.height),i.length>0)for(o=i.length;o--;)h+=i[o];this.total=h,this.initTarget(),this.radius=e.floor(e.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(t,e,n){var r=this.target.getShapeAt(t,e,n);return r!==i&&this.shapes[r]!==i?this.shapes[r]:i},getCurrentRegionFields:function(){var t=this.currentRegion;
return{isNull:this.values[t]===i,value:this.values[t],percent:this.values[t]/this.total*100,color:this.options.get("sliceColors")[t%this.options.get("sliceColors").length],offset:t}},changeHighlight:function(t){var e=this.currentRegion,i=this.renderSlice(e,t),n=this.valueShapes[e];delete this.shapes[n],this.target.replaceWithShape(n,i),this.valueShapes[e]=i.id,this.shapes[i.id]=e},renderSlice:function(t,n){var r,s,a,o,h,l=this.target,u=this.options,c=this.radius,p=u.get("borderWidth"),g=u.get("offset"),f=2*e.PI,d=this.values,v=this.total,m=g?2*e.PI*(g/360):0;for(o=d.length,a=0;o>a;a++){if(r=m,s=m,v>0&&(s=m+f*(d[a]/v)),t===a)return h=u.get("sliceColors")[a%u.get("sliceColors").length],n&&(h=this.calcHighlightColor(h,u)),l.drawPieSlice(c,c,c-p,r,s,i,h);m=s}},render:function(){var t,n,r=this.target,s=this.values,a=this.options,o=this.radius,h=a.get("borderWidth");if(M._super.render.call(this)){for(h&&r.drawCircle(o,o,e.floor(o-h/2),a.get("borderColor"),i,h).append(),n=s.length;n--;)s[n]&&(t=this.renderSlice(n).append(),this.valueShapes[n]=t.id,this.shapes[t.id]=n);r.render()}}}),n.fn.sparkline.box=H=s(n.fn.sparkline._base,{type:"box",init:function(t,e,i,r,s){H._super.init.call(this,t,e,i,r,s),this.values=n.map(e,Number),this.width="auto"===i.get("width")?"4.0em":r,this.initTarget(),this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var t=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return this.loutlier!==i&&t.push({field:"lo",value:this.loutlier}),this.routlier!==i&&t.push({field:"ro",value:this.routlier}),this.lwhisker!==i&&t.push({field:"lw",value:this.lwhisker}),this.rwhisker!==i&&t.push({field:"rw",value:this.rwhisker}),t},render:function(){var t,n,r,s,a,o,l,u,c,p,g,f=this.target,d=this.values,v=d.length,m=this.options,y=this.canvasWidth,x=this.canvasHeight,w=m.get("chartRangeMin")===i?e.min.apply(e,d):m.get("chartRangeMin"),b=m.get("chartRangeMax")===i?e.max.apply(e,d):m.get("chartRangeMax"),_=0;if(H._super.render.call(this)){if(m.get("raw"))m.get("showOutliers")&&d.length>5?(n=d[0],t=d[1],s=d[2],a=d[3],o=d[4],l=d[5],u=d[6]):(t=d[0],s=d[1],a=d[2],o=d[3],l=d[4]);else if(d.sort(function(t,e){return t-e}),s=h(d,1),a=h(d,2),o=h(d,3),r=o-s,m.get("showOutliers")){for(t=l=i,c=0;v>c;c++)t===i&&d[c]>s-r*m.get("outlierIQR")&&(t=d[c]),d[c]<o+r*m.get("outlierIQR")&&(l=d[c]);n=d[0],u=d[v-1]}else t=d[0],l=d[v-1];this.quartiles=[s,a,o],this.lwhisker=t,this.rwhisker=l,this.loutlier=n,this.routlier=u,g=y/(b-w+1),m.get("showOutliers")&&(_=e.ceil(m.get("spotRadius")),y-=2*e.ceil(m.get("spotRadius")),g=y/(b-w+1),t>n&&f.drawCircle((n-w)*g+_,x/2,m.get("spotRadius"),m.get("outlierLineColor"),m.get("outlierFillColor")).append(),u>l&&f.drawCircle((u-w)*g+_,x/2,m.get("spotRadius"),m.get("outlierLineColor"),m.get("outlierFillColor")).append()),f.drawRect(e.round((s-w)*g+_),e.round(.1*x),e.round((o-s)*g),e.round(.8*x),m.get("boxLineColor"),m.get("boxFillColor")).append(),f.drawLine(e.round((t-w)*g+_),e.round(x/2),e.round((s-w)*g+_),e.round(x/2),m.get("lineColor")).append(),f.drawLine(e.round((t-w)*g+_),e.round(x/4),e.round((t-w)*g+_),e.round(x-x/4),m.get("whiskerColor")).append(),f.drawLine(e.round((l-w)*g+_),e.round(x/2),e.round((o-w)*g+_),e.round(x/2),m.get("lineColor")).append(),f.drawLine(e.round((l-w)*g+_),e.round(x/4),e.round((l-w)*g+_),e.round(x-x/4),m.get("whiskerColor")).append(),f.drawLine(e.round((a-w)*g+_),e.round(.1*x),e.round((a-w)*g+_),e.round(.9*x),m.get("medianColor")).append(),m.get("target")&&(p=e.ceil(m.get("spotRadius")),f.drawLine(e.round((m.get("target")-w)*g+_),e.round(x/2-p),e.round((m.get("target")-w)*g+_),e.round(x/2+p),m.get("targetColor")).append(),f.drawLine(e.round((m.get("target")-w)*g+_-p),e.round(x/2),e.round((m.get("target")-w)*g+_+p),e.round(x/2),m.get("targetColor")).append()),f.render()}}}),A=s({init:function(t,e,i,n){this.target=t,this.id=e,this.type=i,this.args=n},append:function(){return this.target.appendShape(this),this}}),I=s({_pxregex:/(\d+)(px)?\s*$/i,init:function(t,e,i){t&&(this.width=t,this.height=e,this.target=i,this.lastShapeId=null,i[0]&&(i=i[0]),n.data(i,"_jqs_vcanvas",this))},drawLine:function(t,e,i,n,r,s){return this.drawShape([[t,e],[i,n]],r,s)},drawShape:function(t,e,i,n){return this._genShape("Shape",[t,e,i,n])},drawCircle:function(t,e,i,n,r,s){return this._genShape("Circle",[t,e,i,n,r,s])},drawPieSlice:function(t,e,i,n,r,s,a){return this._genShape("PieSlice",[t,e,i,n,r,s,a])},drawRect:function(t,e,i,n,r,s){return this._genShape("Rect",[t,e,i,n,r,s])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(t,e){n(e).html(t)},_calculatePixelDims:function(t,e,i){var r;r=this._pxregex.exec(e),this.pixelHeight=r?r[1]:n(i).height(),r=this._pxregex.exec(t),this.pixelWidth=r?r[1]:n(i).width()},_genShape:function(t,e){var i=W++;return e.unshift(i),new A(this,i,t,e)},appendShape:function(){alert("appendShape not implemented")},replaceWithShape:function(){alert("replaceWithShape not implemented")},insertAfterShape:function(){alert("insertAfterShape not implemented")},removeShapeId:function(){alert("removeShapeId not implemented")},getShapeAt:function(){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}}),E=s(I,{init:function(e,r,s,a){E._super.init.call(this,e,r,s),this.canvas=t.createElement("canvas"),s[0]&&(s=s[0]),n.data(s,"_jqs_vcanvas",this),n(this.canvas).css({display:"inline-block",width:e,height:r,verticalAlign:"top"}),this._insert(this.canvas,s),this._calculatePixelDims(e,r,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,this.interact=a,this.shapes={},this.shapeseq=[],this.currentTargetShapeId=i,n(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(t,e,n){var r=this.canvas.getContext("2d");return t!==i&&(r.strokeStyle=t),r.lineWidth=n===i?1:n,e!==i&&(r.fillStyle=e),r},reset:function(){var t=this._getContext();t.clearRect(0,0,this.pixelWidth,this.pixelHeight),this.shapes={},this.shapeseq=[],this.currentTargetShapeId=i},_drawShape:function(t,e,n,r,s){var a,o,h=this._getContext(n,r,s);for(h.beginPath(),h.moveTo(e[0][0]+.5,e[0][1]+.5),a=1,o=e.length;o>a;a++)h.lineTo(e[a][0]+.5,e[a][1]+.5);n!==i&&h.stroke(),r!==i&&h.fill(),this.targetX!==i&&this.targetY!==i&&h.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=t)},_drawCircle:function(t,n,r,s,a,o,h){var l=this._getContext(a,o,h);l.beginPath(),l.arc(n,r,s,0,2*e.PI,!1),this.targetX!==i&&this.targetY!==i&&l.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=t),a!==i&&l.stroke(),o!==i&&l.fill()},_drawPieSlice:function(t,e,n,r,s,a,o,h){var l=this._getContext(o,h);l.beginPath(),l.moveTo(e,n),l.arc(e,n,r,s,a,!1),l.lineTo(e,n),l.closePath(),o!==i&&l.stroke(),h&&l.fill(),this.targetX!==i&&this.targetY!==i&&l.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=t)},_drawRect:function(t,e,i,n,r,s,a){return this._drawShape(t,[[e,i],[e+n,i],[e+n,i+r],[e,i+r],[e,i]],s,a)},appendShape:function(t){return this.shapes[t.id]=t,this.shapeseq.push(t.id),this.lastShapeId=t.id,t.id},replaceWithShape:function(t,e){var i,n=this.shapeseq;for(this.shapes[e.id]=e,i=n.length;i--;)n[i]==t&&(n[i]=e.id);delete this.shapes[t]},replaceWithShapes:function(t,e){var i,n,r,s=this.shapeseq,a={};for(n=t.length;n--;)a[t[n]]=!0;for(n=s.length;n--;)i=s[n],a[i]&&(s.splice(n,1),delete this.shapes[i],r=n);for(n=e.length;n--;)s.splice(r,0,e[n].id),this.shapes[e[n].id]=e[n]},insertAfterShape:function(t,e){var i,n=this.shapeseq;for(i=n.length;i--;)if(n[i]===t)return n.splice(i+1,0,e.id),void(this.shapes[e.id]=e)},removeShapeId:function(t){var e,i=this.shapeseq;for(e=i.length;e--;)if(i[e]===t){i.splice(e,1);break}delete this.shapes[t]},getShapeAt:function(t,e,i){return this.targetX=e,this.targetY=i,this.render(),this.currentTargetShapeId},render:function(){var t,e,i,n=this.shapeseq,r=this.shapes,s=n.length,a=this._getContext();for(a.clearRect(0,0,this.pixelWidth,this.pixelHeight),i=0;s>i;i++)t=n[i],e=r[t],this["_draw"+e.type].apply(this,e.args);this.interact||(this.shapes={},this.shapeseq=[])}}),q=s(I,{init:function(e,i,r){var s;q._super.init.call(this,e,i,r),r[0]&&(r=r[0]),n.data(r,"_jqs_vcanvas",this),this.canvas=t.createElement("span"),n(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:e,height:i,margin:"0px",padding:"0px",verticalAlign:"top"}),this._insert(this.canvas,r),this._calculatePixelDims(e,i,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,s='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>',this.canvas.insertAdjacentHTML("beforeEnd",s),this.group=n(this.canvas).children()[0],this.rendered=!1,this.prerender=""},_drawShape:function(t,e,n,r,s){var a,o,h,l,u,c,p,g=[];for(p=0,c=e.length;c>p;p++)g[p]=""+e[p][0]+","+e[p][1];return a=g.splice(0,1),s=s===i?1:s,o=n===i?' stroked="false" ':' strokeWeight="'+s+'px" strokeColor="'+n+'" ',h=r===i?' filled="false"':' fillColor="'+r+'" filled="true" ',l=g[0]===g[g.length-1]?"x ":"",u='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+t+'" '+o+h+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+a+" l "+g.join(", ")+" "+l+'e"> </v:shape>'},_drawCircle:function(t,e,n,r,s,a,o){var h,l,u;return e-=r,n-=r,h=s===i?' stroked="false" ':' strokeWeight="'+o+'px" strokeColor="'+s+'" ',l=a===i?' filled="false"':' fillColor="'+a+'" filled="true" ',u='<v:oval  id="jqsshape'+t+'" '+h+l+' style="position:absolute;top:'+n+"px; left:"+e+"px; width:"+2*r+"px; height:"+2*r+'px"></v:oval>'},_drawPieSlice:function(t,n,r,s,a,o,h,l){var u,c,p,g,f,d,v,m;if(a===o)return"";if(o-a===2*e.PI&&(a=0,o=2*e.PI),c=n+e.round(e.cos(a)*s),p=r+e.round(e.sin(a)*s),g=n+e.round(e.cos(o)*s),f=r+e.round(e.sin(o)*s),c===g&&p===f){if(o-a<e.PI)return"";c=g=n+s,p=f=r}return c===g&&p===f&&o-a<e.PI?"":(u=[n-s,r-s,n+s,r+s,c,p,g,f],d=h===i?' stroked="false" ':' strokeWeight="1px" strokeColor="'+h+'" ',v=l===i?' filled="false"':' fillColor="'+l+'" filled="true" ',m='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+t+'" '+d+v+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+n+","+r+" wa "+u.join(", ")+' x e"> </v:shape>')},_drawRect:function(t,e,i,n,r,s,a){return this._drawShape(t,[[e,i],[e,i+r],[e+n,i+r],[e+n,i],[e,i]],s,a)},reset:function(){this.group.innerHTML=""},appendShape:function(t){var e=this["_draw"+t.type].apply(this,t.args);return this.rendered?this.group.insertAdjacentHTML("beforeEnd",e):this.prerender+=e,this.lastShapeId=t.id,t.id},replaceWithShape:function(t,e){var i=n("#jqsshape"+t),r=this["_draw"+e.type].apply(this,e.args);i[0].outerHTML=r},replaceWithShapes:function(t,e){var i,r=n("#jqsshape"+t[0]),s="",a=e.length;for(i=0;a>i;i++)s+=this["_draw"+e[i].type].apply(this,e[i].args);for(r[0].outerHTML=s,i=1;i<t.length;i++)n("#jqsshape"+t[i]).remove()},insertAfterShape:function(t,e){var i=n("#jqsshape"+t),r=this["_draw"+e.type].apply(this,e.args);i[0].insertAdjacentHTML("afterEnd",r)},removeShapeId:function(t){var e=n("#jqsshape"+t);this.group.removeChild(e[0])},getShapeAt:function(t){var e=t.id.substr(8);return e},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})})}(document,Math),window.StockApp={},window.StockApp.Views={},window.StockApp.Models={},window.StockApp.Collections={},function(t,e,i,n){"use strict";t.Models.StockDetail=i.Model.extend({rootUrl:"/api/stocks/"}),t.Collections.StockList=i.Collection.extend({url:"/api/stocks"}),t.Views.Detail=i.View.extend({el:".detail",events:{dblclick:"mykeypress",keypress:"mykeypress","click .three":"mykeypress"},mykeypress:function(){console.log("woohoo")},template:n.template(e("#detail").html()),initialize:function(e){this.ticker=e.ticker,this.model=new t.Models.StockDetail,this.model.url=function(){return this.rootUrl+e.ticker},this.model.fetch({success:n.bind(this.render,this)})},render:function(){this.$el.html(this.template({ticker:this.ticker,data:this.model.toJSON()})),this.$el.find(".linechart").sparkline("html",{chartRangeMin:1,chartRangeMax:20})},show:function(){document.title="Stock App | "+this.ticker,this.$el.fadeIn(100)},hide:function(){document.title="Stock App",this.$el.fadeOut(100)}}),t.Views.Index=i.View.extend({el:".list",template:n.template(e("#index").html()),events:{dblclick:"mykeypress",keypress:"mykeypress","click .three":"mykeypress"},mykeypress:function(){console.log("woohoo Index")},initialize:function(){this.collection.fetch({success:n.bind(this.render,this)})},render:function(){this.$el.html(this.template({stocks:this.collection.toJSON()}))},showDetail:function(e){this.detail=new t.Views.Detail(e),this.detail.show()},hideDetail:function(){this.detail.hide()}}),t.Router=i.Router.extend({routes:{"":"index",":ticker":"detail"},index:function(){this.indexView?this.indexView.hideDetail():this.indexView=new t.Views.Index({collection:new t.Collections.StockList})},detail:function(t){this.indexView||this.index(),this.indexView.showDetail({ticker:t})}}),new t.Router,i.history.start()}(window.StockApp,window.jQuery,window.Backbone,window._);